name: Build Kernel

on:
  workflow_dispatch:
  watch:
    types: [started]

defaults:
  run:
    shell: bash

jobs:
  build:
    runs-on: fedora-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Set Swap Space
        uses: pierotofy/set-swap-space@master
        with:
          swap-size-gb: 5

      - name: setup package
        run: |
          sudo dnf update -y && sudo dnf upgrade -y
          sudo dnf install -y dialog bash sed wget git curl zip tar jq expect make cmake automake autoconf llvm lld lldb clang gcc binutils bison perl gperf gawk flex bc python3 zstd openssl unzip cpio bc bison @development-tools ccache liblz4-tool SDL-devel libstdc++ zlib-devel libxml2 libxml2-utils lzop pngcrush schedtool squashfs-tools xsltproc zlib-devel ncurses-devel bzip2 git gcc gcc-c++ openssl-devel dos2unix kmod python2 aria2 glibc-source

      - name: Clone environments
        run: |
          wget https://github.com/bintang774/eraselk-gcc/releases/download/07042024/eraselk-gcc-arm64-07042024.xz -O tc
          tar -xf tc && mv -f ./gcc-arm64 ./gcc
          rm -f tc
          git clone --depth=1 https://github.com/bintang774/anykernel.git anykernel

      - name: Cleanup
        run: |
          make clean
          make mrproper
          rm -rf out
          find . -type f -exec chmod 777 {} +
          
      - name: Build Kernel
        run: |
          sleep 10
          $(pwd)/build.sh
